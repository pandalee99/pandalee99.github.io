<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SpringMVC详解（二）"><meta name="keywords" content="SpringBoot,SSM"><meta name="author" content="攀"><meta name="copyright" content="攀"><title>SpringMVC详解（二） | 小世界</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="小世界" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC详解（二）"><span class="toc-number">1.</span> <span class="toc-text">SpringMVC详解（二）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#控制器"><span class="toc-number">1.1.</span> <span class="toc-text">控制器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#处理器映射"><span class="toc-number">1.1.1.</span> <span class="toc-text">处理器映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取控制器参数"><span class="toc-number">1.1.2.</span> <span class="toc-text">获取控制器参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在无注解下获取参数"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">在无注解下获取参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在注解的情况下获取参数"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">在注解的情况下获取参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传递数组"><span class="toc-number">1.1.3.</span> <span class="toc-text">传递数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传递JSON"><span class="toc-number">1.1.4.</span> <span class="toc-text">传递JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HTML页面"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">HTML页面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#add和insert方法"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">add和insert方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过URL传递参数"><span class="toc-number">1.1.5.</span> <span class="toc-text">通过URL传递参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取格式化参数"><span class="toc-number">1.1.6.</span> <span class="toc-text">获取格式化参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#测试日期表单"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">测试日期表单</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#控制器打开页面和提交"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">控制器打开页面和提交</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义参数转换规则"><span class="toc-number">1.2.</span> <span class="toc-text">自定义参数转换规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#处理器获取参数逻辑"><span class="toc-number">1.2.1.</span> <span class="toc-text">处理器获取参数逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一对一转换器"><span class="toc-number">1.2.2.</span> <span class="toc-text">一对一转换器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#字符串用户转换器"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">字符串用户转换器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GenericConverter集合和数组转换"><span class="toc-number">1.2.3.</span> <span class="toc-text">GenericConverter集合和数组转换</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/pandalee99/image_store/master/hexo/c17f0489-42cd-439a-94bd-0612598b142f.jpg"></div><div class="author-info__name text-center">攀</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/Pandalee99">GitHub</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">85</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">59</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">链接</div><a class="author-info-links__name text-center" href="https://github.com/Pandalee99/Concurrent-programming">GItHub配套资源</a><a class="author-info-links__name text-center" href="https://translate.google.cn/" target="_blank" rel="noopener">Google翻译</a><a class="author-info-links__name text-center" href="https://www.bilibili.com/" target="_blank" rel="noopener">bilibili</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://bbsfiles.vivo.com.cn/vivobbs/attachment/forum/201706/23/120105q39c9ql9syl7b4ye.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">小世界</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">SpringMVC详解（二）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-14</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="SpringMVC详解（二）"><a href="#SpringMVC详解（二）" class="headerlink" title="SpringMVC详解（二）"></a>SpringMVC详解（二）</h2><p>SpringMVC开发中，控制器的开发是最为重要的一步，而开发控制器的第一步就是让控制器的方法能够与请求的URL对应起来，这就是注＠RequestMappi吨的功能，所以我们从这个注解开始讨论。</p>
<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><h4 id="处理器映射"><a href="#处理器映射" class="headerlink" title="处理器映射"></a>处理器映射</h4><p>正如前面所提及的，如果Web工程使用SpringMVC，那么它在启动阶段就会将注解@RequestMapping所配置的内容保存到处理器映射（HandlerMapping）机制中去，后等待请求的到来，通过拦截请求信息与HandlerMapping进行匹配，找到对应的处理器（它包含控制器的逻辑），并将处理器及其拦截器保到HandlerExecutionChain对象中，返回给DispatcherServlet，这样DispatcherServlet就可以运行它们了。</p>
<p>从论述中可以看到，HandlerMapping的主要任务是将请求定位到具体的处理器上。关于＠RequestMapping的配置项并不多，这里通过源码来学习</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementTypeMETHOD,ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestMapping&#123;</span><br><span class="line">    /／配置请求映射名称</span><br><span class="line">       <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span></span><br><span class="line"><span class="function">    ／／通过路径映射@<span class="title">AliasFor</span><span class="params">(”path<span class="string">")</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">       String[] value()default&#123;&#125;;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">     ／／通过路径映射回path配置项目</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">     @AliasFor（”value”）</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">       String[] path() default&#123;&#125;;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">     ／／限定只响应HTTP请求类型，如GET,POST、HEAD、OPTIONS、PUT、TRACE等</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">      ／／默认的情况下，可以响应所有的请求类型</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">      RequestMethod[] method() default&#123;&#125;;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">      ／／当存在对应的HTTP参数时才响应请求</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">       String[] params() default&#123;&#125;;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">       ／／限定请求头存在对应的参数时才响应</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">       String[] headers() default&#123;&#125;;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">        ／／限定HTTP请求体提交类型，如”applicat工on／〕son”、Htext/html”</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">       String[] consumes() default&#123;&#125;;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">        ／／限定返回的内容类型，仅当HTTPi苛求头中的（Accept）类型中包含该指定类型时才返回</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">         String[] produces() default&#123;&#125;;</span></span></span></span><br></pre></td></tr></table></figure>

<p>这里可以通过配置项value或者path来设置请求URL。从而让对应的请求映射到控制器或其方法上，在此基础上还可以通过其他配置项来缩小请求映射的范围。</p>
<p>当然，配置项value和path也可以通过正则式来让方法匹配多个请求。</p>
<p>但是从现实的角度来说，如果不是有必要，尽量不要这么做。因为这样请求的匹配规则就复杂了，会对后续开发造成一定的困扰。</p>
<p>因此在能够明确场景下，都建议一个路径对应一个方法或者让正则式的匹配规则简单明了，这样就能够提高程序的可读性，以利于后续的维护和改造。</p>
<p>路径是必需的配置项，这里的method配置项可以限定HTTP的请求类型，这是最常用的配置项，可以区分HTTP的GET或者POST等不同的请求。</p>
<p>只是在Spring4.3的版本之后，为了简化method配置项的配置新增了几个注解，如＠GetMapping、＠PostMapping、＠PatchMapping、＠PutMapping和@DeleteMapping。</p>
<h4 id="获取控制器参数"><a href="#获取控制器参数" class="headerlink" title="获取控制器参数"></a>获取控制器参数</h4><p>处理器是对控制器的包装，在处理器运行的过程中会调度控制器的方法，只是它在进入控制器方法之前会对HTTP的参数和上下文进行解析，将它们转换为控制器所需的参数。这一步是处理器首先需要做的事情，只是在大部分的情况下不需要自己去开发这一步，因为SpringMVC已经提供了大量的转换规则，通过这些规则就能非常简易地获取大部分的参数。正如之前章节一样，在大部分情况下，我们并没有太在意如何获取参数，那是因为之前的场景都比较简单，在实际的开发中可能遇到一些复杂的场景，这样参数的获取就会变得复杂起来。例如，可能前端传递一个格式化的日期参数，又如需要传递复杂的对象给控制器，这个时候就需要对SpringMVC参数的获取做进一步的学习了。</p>
<h5 id="在无注解下获取参数"><a href="#在无注解下获取参数" class="headerlink" title="在无注解下获取参数"></a>在无注解下获取参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/my"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在无注解下获取参数，要求参数名称和HTTP请求参数名称一致.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intVal</span></span><br><span class="line"><span class="comment">     *            -- 整数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> longVal</span></span><br><span class="line"><span class="comment">     *            -- 长整形</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     *            --字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应JSON参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// HTTP GET请求</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/no/annotation"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">noAnnotation</span><span class="params">(Integer intVal, Long longVal, String str)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; paramsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        paramsMap.put(<span class="string">"intVal"</span>, intVal);</span><br><span class="line">        paramsMap.put(<span class="string">"longVal"</span>, longVal);</span><br><span class="line">        paramsMap.put(<span class="string">"str"</span>, str);</span><br><span class="line">        <span class="keyword">return</span> paramsMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后打开浏览器，输入：<a href="http://localhost:8888/my/no/annotation?intVal=10&amp;longVal=200进行测试。" target="_blank" rel="noopener">http://localhost:8888/my/no/annotation?intVal=10&amp;longVal=200进行测试。</a></p>
<p>这里的表达很明确，就接收参数是什么，那填写的信息就必须是什么，这样的做法，在如今前后端分离的情况下非常不具有优势，很可能前后和后端需要的参数不同，所以，我们一般会使用注解的方式，来表达我们的值。</p>
<h5 id="在注解的情况下获取参数"><a href="#在注解的情况下获取参数" class="headerlink" title="在注解的情况下获取参数"></a>在注解的情况下获取参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/my"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;   </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过注解<span class="doctag">@RequestParam</span>获取参数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intVal</span></span><br><span class="line"><span class="comment">     *            -- 整数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> longVal</span></span><br><span class="line"><span class="comment">     *            -- 长整形</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     *            --字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应JSON数据集</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/annotation"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">requestParam</span><span class="params">(@RequestParam(<span class="string">"int_val"</span>)</span> Integer intVal,</span></span><br><span class="line"><span class="function">                                            @<span class="title">RequestParam</span><span class="params">(<span class="string">"long_val"</span>)</span> Long longVal, @<span class="title">RequestParam</span><span class="params">(<span class="string">"str_val"</span>)</span> String strVal) </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; paramsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        paramsMap.put(<span class="string">"intVal"</span>, intVal);</span><br><span class="line">        paramsMap.put(<span class="string">"longVal"</span>, longVal);</span><br><span class="line">        paramsMap.put(<span class="string">"strVal"</span>, strVal);</span><br><span class="line">        <span class="keyword">return</span> paramsMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中可以看到，在方法参数处使用了注解＠RequestParam，目的是指定HTTP参数和方法参数的映射关系，这样处理器就会按照其配的映射关系来得到参数，然后调用控制器的方法。</p>
<p>启动SpringBoot应用后，在浏览器地址栏输入<a href="http://localhost:8888/my/annotation?intval=l&amp;longva1=2&amp;strval=str，就能够看到请求的结果了。" target="_blank" rel="noopener">http://localhost:8888/my/annotation?intval=l&amp;longva1=2&amp;strval=str，就能够看到请求的结果了。</a></p>
<p>但如果把个HTTP参数中的任意一个删去，就会得到异常信息，因为在默认的情况下＠RequestPara标注的参数是不能为空的，为了让它能够为空，可以配置其属性required为false。</p>
<h4 id="传递数组"><a href="#传递数组" class="headerlink" title="传递数组"></a>传递数组</h4><p>除了传递一些简单的值之外，还能够传递数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/requestArray"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">requestArray</span><span class="params">(<span class="keyword">int</span>[] intArr, Long[] longArr, String[] strArr)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; paramsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    paramsMap.put(<span class="string">"intArr"</span>, intArr);</span><br><span class="line">    paramsMap.put(<span class="string">"longArr"</span>, longArr);</span><br><span class="line">    paramsMap.put(<span class="string">"strArr"</span>, strArr);</span><br><span class="line">    <span class="keyword">return</span> paramsMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在页面上得到的数值的值，是通过逗号隔开的。</p>
<h4 id="传递JSON"><a href="#传递JSON" class="headerlink" title="传递JSON"></a>传递JSON</h4><p>JSON已经成为当今我的数据规范了，所以，我们来展示一下如何表达：前后端互相传递JSON的情况。</p>
<h5 id="HTML页面"><a href="#HTML页面" class="headerlink" title="HTML页面"></a>HTML页面</h5><p>首先需要建立一个表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载Query文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.2.0.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#submit"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> userName = $(<span class="string">"#userName"</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> note = $(<span class="string">"#note"</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> ($.trim(userName)==<span class="string">''</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                    alert(<span class="string">"用户名不能为空！"</span>);</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">return</span>;</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="actionscript">                <span class="keyword">var</span> params = &#123;</span></span><br><span class="line">                    userName : userName,</span><br><span class="line">                    note : note</span><br><span class="line">                &#125;;</span><br><span class="line"><span class="javascript">                $.post(&#123;</span></span><br><span class="line"><span class="actionscript">                    url : <span class="string">"./insert"</span>,</span></span><br><span class="line"><span class="actionscript">                    <span class="comment">// 此处需要告知传递参数类型为JSON，不能缺少</span></span></span><br><span class="line"><span class="actionscript">                    contentType : <span class="string">"application/json"</span>,</span></span><br><span class="line"><span class="actionscript">                    <span class="comment">// 将JSON转化为字符串传递</span></span></span><br><span class="line"><span class="javascript">                    data : <span class="built_in">JSON</span>.stringify(params),</span></span><br><span class="line"><span class="actionscript">                    <span class="comment">// 成功后的方法</span></span></span><br><span class="line"><span class="actionscript">                    success : <span class="function"><span class="keyword">function</span><span class="params">(result)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">if</span> (result == <span class="literal">null</span> || result.id == <span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                            alert(<span class="string">"插入失败"</span>);</span></span><br><span class="line"><span class="actionscript">                            <span class="keyword">return</span>;</span></span><br><span class="line">                        &#125;</span><br><span class="line"><span class="actionscript">                        alert(<span class="string">"插入成功"</span>);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin: 20px 0;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"insertForm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名称：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"userName"</span> <span class="attr">name</span>=<span class="string">"userName"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>备注<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"note"</span> <span class="attr">name</span>=<span class="string">"note"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"submit"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里定义了一个简易的表单，它使用了jQuery进行Ajax提交。</p>
<p>注意它的JS代码，它指定了提交的请求地址Curl）、数据（data）、提交类型（contentType）和事后事件（success）。</p>
<p>从代码来看，这里先组织了一个JSON数据集，而且把提交类型也设置为了JSON类，然后才提交到控制器。</p>
<p>这样控制器就可以得到一个JSON数据集的请求体了为了打开这个表单，需要在UserController中编写一个add方法，它将返回一个字符串，映射到这个表单上，这样就能通过视图解析器（ViewResolver）找到它了。</p>
<p>然后再写一个相应新增用户的请求insert方法，它将从HTTP请求体中读出这个JSON。</p>
<h5 id="add和insert方法"><a href="#add和insert方法" class="headerlink" title="add和insert方法"></a>add和insert方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 注入用户服务类</span></span><br><span class="line">		<span class="meta">@Autowired</span></span><br><span class="line">		<span class="keyword">private</span> UserService userService = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 打开请求页面</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@return</span> 字符串，指向页面</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="meta">@GetMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"add"</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 新增用户</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">		 *            通过<span class="doctag">@RequestBody</span>注解得到JSON参数</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@return</span> 回填id后的用户信息</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="meta">@PostMapping</span>(<span class="string">"/insert"</span>)</span><br><span class="line">		<span class="meta">@ResponseBody</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> User <span class="title">insert</span><span class="params">(@RequestBody User user)</span> </span>&#123;</span><br><span class="line">			userService.insertUser(user);</span><br><span class="line">			<span class="keyword">return</span> user;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>这样通过请求add方法，就能请求到对应的HTML表单。接着录入表单，点击提交按钮，这样通过JavaScript脚本提交JSON消息，就可以请求到控制器的insert方法。</p>
<p>这个方法的参数标注为@RequestBody，意味着它将接收前提交的JSON请求体，而在JSON请求体与User类之间的属性名称是保持一致的，这样SpringMVC就会通过这层映射关系将JSON请求体转换为User对象。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/1.png" alt=""></p>
<h4 id="通过URL传递参数"><a href="#通过URL传递参数" class="headerlink" title="通过URL传递参数"></a>通过URL传递参数</h4><p>当然讲到传递参数，之前也提到了以REST风格的方式去传递参数，那么我们在这里就列出来先吧。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// &#123;...&#125;代表占位符，还可以配置参数名称</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="comment">// 响应为JSON数据集</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">// @PathVariable通过名称获取参数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> userService.getUser(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样在浏览器中直接输入 user/1 浏览器就会自动将这个 “1” 识别为id的值。</p>
<h4 id="获取格式化参数"><a href="#获取格式化参数" class="headerlink" title="获取格式化参数"></a>获取格式化参数</h4><p>一些应用中，往往需要格式化数据，其中最为典型的当属日期和货币。例如，在一些系统中日期格式约定为yyyy-MM-dd，金额约定为货币符号和用逗号分隔，如100万美元写作$1,000,000.00等。</p>
<p>同样地，SpringMVC也对此提供了良好的支持。对日期和数字类型的转换注解进行处理，分别是＠DateTimeFormat和＠NumberFormato其中@DateTimeFormat是针对日期进行格式化的，＠NumberFormat则是针对数字进行格式化的。</p>
<h5 id="测试日期表单"><a href="#测试日期表单" class="headerlink" title="测试日期表单"></a>测试日期表单</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>格式化<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./commit"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>日期（yyyy-MM-dd）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">value</span>=<span class="string">"2017-08-08"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>金额（#,###.##）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"number"</span> <span class="attr">value</span>=<span class="string">"1,234,567.89"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"2"</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>表单中有两个文本框，一个日期，一个金额。</p>
<h5 id="控制器打开页面和提交"><a href="#控制器打开页面和提交" class="headerlink" title="控制器打开页面和提交"></a>控制器打开页面和提交</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 映射HTML页面</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/form"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">showFormat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"formatter"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取提交参数</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/commit"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">format</span><span class="params">(Date date,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  @NumberFormat(pattern = <span class="string">"#,###.##"</span>)</span> Double number) </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; dataMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    dataMap.put(<span class="string">"date"</span>, date);</span><br><span class="line">    dataMap.put(<span class="string">"number"</span>, number);</span><br><span class="line">    <span class="keyword">return</span> dataMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的showFormat方法，是将请求映射到HTML表单上。format方法的代码使用了注解@DateTimeFormat和＠NumberFormat，它们配置了格式化所约定的格式，所以Spring会根据约定的格式把数据转换出来，这样就可以完成参数的转换。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/2.png" alt=""></p>
<p>启动SpringBoot后，请求<a href="http://localhost:8080/my/form，就可以看到图所示的表单。" target="_blank" rel="noopener">http://localhost:8080/my/form，就可以看到图所示的表单。</a></p>
<p>提交表单后，就可以看到对应的JSON数据集输出，这样就可以获取那些格式化的参数了。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/3.png" alt=""></p>
<p>在SpringBoot中，日期参数的格式化也可以不使用＠DateTimeFormat，而只在配置文件application.properties中加入如下配置项即可：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mvc.date-format</span>=<span class="string">yyyy-MM-dd</span></span><br></pre></td></tr></table></figure>



<h3 id="自定义参数转换规则"><a href="#自定义参数转换规则" class="headerlink" title="自定义参数转换规则"></a>自定义参数转换规则</h3><p>根据上面所表述的内容，我们很容易就能够得出一个规律，传递参数的方法，很多时候仅仅只需要更换不同的注解，就能够实现相应的需求。</p>
<p>那么这些注解是怎么运作的呢？或者说，SpringMVC所实现的参数转换规则，是怎么样的呢？</p>
<p>HTTP的请求包含请求头（Header）、请求体CBody）、URL和参数等内容，服务器还包含其上下文环境和客户端交互会话（Session）机制，而这里的消息转换是指请求体的转换。下面我们讨论SpringMVC是如何从这些HTTP请求中获取参数的。</p>
<h4 id="处理器获取参数逻辑"><a href="#处理器获取参数逻辑" class="headerlink" title="处理器获取参数逻辑"></a>处理器获取参数逻辑</h4><p>一个请求来到时，在处理器执行的过程中，它首先会从HTTP请求和上下文环境来得到参数。如果是简易的参数它会以简单的转换器进行转换，而这些简单的转换器是SpringMVC自身己经提供了的。</p>
<p>但是如果是转换HTTP请求体（Body），它就会调用HttpMessageConverter接口的方法对请求体的信息进行转换，首先它会先判断能否对请求体进行转换，如果可以就会将其转换为Java类型。以下是对HttpMessageConverter接口的探讨。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HttpMessageConverter</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    ／／是否可读，其中clazz为Java型，ediaType为HTTP请求类型</span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">canRead</span><span class="params">(Class＜?＞ clazz,MediaType mediaType)</span></span>;</span><br><span class="line">    ／／判断clazz类型是否能够转换为mediaT_rpe媒体类型</span><br><span class="line">        ／／其中clazzjava类型，mediaType为HTTP响应类型</span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">canWrite</span><span class="params">(Class&lt;?&gt; clazz,MediaType mediaType)</span></span>;</span><br><span class="line">    ／／可支持的媒体类型列表</span><br><span class="line">        <span class="function">List&lt;MediaType&gt; <span class="title">getSupportedMediaTypes</span><span class="params">()</span></span>;</span><br><span class="line">    ／／当canRead验证通过后，读入HTTP求信息</span><br><span class="line">        <span class="function">T <span class="title">read</span><span class="params">(Class&lt;?extendsT&gt; clazz,HttpinputMessage inputMessage)</span> <span class="keyword">throws</span> IOException,HttpMessage NotReadableException</span>;</span><br><span class="line">    ／／当canWrite方法验证通过后，写入响应</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(Tt,MediaType contentType,HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException,HttpMessage NotWritableException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中控制器方法的参数标注了＠RequestBody，所以处理器会采用请求体（Body）的内容进行参数转换。</p>
<p>而前端的请求体为JSON类型，所以首先它会调用canRead方法来确定请求体是否可读。</p>
<p>如果判定可读后，接着就是使用read方法，将前端提交的用户JSON类型的请求体转换为控制器的用户（User）类参数，这样控制器就能够得到参数了。</p>
<p>上面的HttpMessageConverter接口只是将HTTP的请求体转换为对应的Java对象，而对于HTTP参数和其他内容，还没有进行讨论。</p>
<p>例如，以性别参数来说前端可能传递给控制器的是一个整数，而控制器参数却是一个枚举，这样就需要提供自定义的参数转换规则。</p>
<p>为了讨论自定义的参数规则，很有必要先了解处理器转换参数的过程。在SpringMVC中，是通过WebDataBinder机制来获取参数的，它的主要作用是解析HTTP请求的上下文，然后在控制器的调用之前转换参数并且提供验证的功能，为调用控制器方法做准备。</p>
<p>处理器会从HTTP请求中读取数据，然后通过三种接口来进行各类参数转换，这种接口是Converter、Formatter和GenericConverter。</p>
<p>在SpringMVC的机制中这三种接口的实现类都采用了注册机的机制，默认的情况下SpringMVC己经在注册机内注册了许多的转换器，这样就可以实现大部分的数据类型的转换，所以在大部分的情况下无须开发者再提供转换器，</p>
<p>同样地，需要自定义转换规则时，需要在注册机上注册自己的转换器就可以了。</p>
<p>实际上，WebDataBinder机制还有一个重要的功能，那就是验证转换结果。关于验证机制，后面会再讨论。有了参数的转换和验证，最终控制器就可以得到合法的参数。得到这些参数后，就可以调用控制器的方法了。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/images/1.png" alt=""></p>
<p>这个图严格来说是请求体转换的全流程，但是有些时候SpringMVC并不会走完全程，而是根据现实情况来处理消息的转换。</p>
<p>根据上面的讨论，可以看到控制器的参数是处理器通过Convert町、Formatter和GenericConverter这三个接口转换出来的。</p>
<p>这里先谈谈这三个接口的不同之处。</p>
<ol>
<li>首先，Converter是一个普通的转换器，例如，有一个Integer类型的控制器参数，而从HTTP对应的为字符串，对应的Converter就会将字符串转换为Integer类型：</li>
<li>其次，Formatter则是一个格式化转换器，类似那些日期字符串就是通过它按照约定的格式转换为日期的；</li>
<li>最后，GenericConverter转换器则将HTTP参数转换为数组。</li>
</ol>
<p>这就是上述例子可以通过比较简单的注解就能够得到各类参数的原因。</p>
<p>对于数据类型转换，SpringMVC提供了→个服务机制去管理，它就是ConversionService接口。在默认的情况下，会使用这个接口的子类DefaultFormattingConversionService对象来管理这些转换类。</p>
<p>其关系如图所示：</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/images/2.png" alt=""></p>
<p>从图可以看出，Converter、Formatter和GenericConverter可以通过注册机接口进行注册，这样处理器就可以获取对应的转换器来实现参数的转换。上面讨论的是普通SpringMVC的参数转换规则，而在SpringBoot中还提供了特殊的机制来管理这些转换器。SpringBoot的自动配置类WebMvcAutoConfiguration还定义了一个内部类WebMvcAuto­ConfigurationAdapter。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册各类转换器，registry实际为DefaultFormattingConversionService对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistryregistry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">//遍历IoC容器，找到Converter类型的Bean注册到服务类中</span></span><br><span class="line">        <span class="keyword">for</span>(Converter&lt;?,?&gt; converter:getBeansOfType(Converter<span class="class">.<span class="keyword">class</span>)) </span>&#123; </span><br><span class="line">            registry.addConverter(converter);</span><br><span class="line">     <span class="comment">//遍历IoC容器，找到GenericConverter类型的Bean注册到服务类中</span></span><br><span class="line">         <span class="keyword">for</span>(GenericConverter converter:getBeansOfType(GenericConverter<span class="class">.<span class="keyword">class</span>))</span>&#123;</span><br><span class="line">                    registry.addConverter(converter);</span><br><span class="line">      <span class="comment">//遍历IoC容器，找到Formatter类型的Bean注册到服务类中</span></span><br><span class="line">         <span class="keyword">for</span>(Formatter&lt;?&gt; formatter:getBeansOfType(Formatter<span class="class">.<span class="keyword">class</span>))</span>&#123;</span><br><span class="line">                            registry.addFormatter(formatter);</span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中加入了中文注释以利于理解，通过这个方法，可以看到在SpringBoot的初始化中，会将对应用户自定义的Converter、Formatter和GenericConverter的实现类所创建的SpringBean自动地注册到DefaultFormattingConversionService对象中。</p>
<p>这样对于开发者只需要自定义Converter、Formatter和GenericConverter的接口的Bean,SpringBoot就会通过这个方法将它们注册到ConversionService对象中。只是格式化Formatter接口，在实际开发中使用率比较低，所以不再论述。</p>
<h4 id="一对一转换器"><a href="#一对一转换器" class="headerlink" title="一对一转换器"></a>一对一转换器</h4><p>Converter是一对一的转化器，也就是从一种类型转换为另外一种类型，其接口定义十分简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">interface</span>  <span class="title">Converter</span>&lt;<span class="title">S</span> ,  <span class="title">T</span>&gt;  </span>&#123;</span><br><span class="line">    <span class="function">T  <span class="title">convert</span><span class="params">(S  source )</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个接口的类型有源类型CS）和目标类型(T）两种，它们通过conv创方法进行转换。</p>
<p>例如，HTTP的类型为字符串（String）型，而控制器参数为Long型，那么就可以通过Spring内部提供的StringToNumber&lt;TextendsNumber＞进行转换。</p>
<p>假设前端要传递一个用户的信息，这个用户信息的格式是｛id}-{userName｝”｛note｝，而控制器的参数是User类对象。</p>
<p>因为这个格式比较特殊，Spring当前并没有对应的Converter进行转换，因此需要自定义转换器。这里需要的是一个从String转换为User的转换器：</p>
<h5 id="字符串用户转换器"><a href="#字符串用户转换器" class="headerlink" title="字符串用户转换器"></a>字符串用户转换器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义字符串用户转换器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToUserConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">convert</span><span class="params">(String userStr)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        String []strArr = userStr.split(<span class="string">"-"</span>);</span><br><span class="line">        Long id = Long.parseLong(strArr[<span class="number">0</span>]);</span><br><span class="line">        String userName = strArr[<span class="number">1</span>];</span><br><span class="line">        String note = strArr[<span class="number">2</span>];</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setUserName(userName);</span><br><span class="line">        user.setNote(note);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的类标注为＠Component，并且实现了Converter接口，这样Spring就会将这个类扫描并装配到IoC容器中。对于SpringBoot，之前分析过它会在初始化时把这类自动地注册到转换机制中，所以注册这步并不需要人再处理。这里泛型指定为String和User，这样SpringMVC就会通过HTTP的参数类型（String）和控制器的数类型（User）进行匹配，就可以从注册机制中发现这个转换类，这样就能够将参数转换出来。下面写一个控制器方法对其进行验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/converter"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUserByConverter</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后打开浏览器，输入：<a href="http://localhost:8888/user/converter?user=9-谢广坤-路人" target="_blank" rel="noopener">http://localhost:8888/user/converter?user=9-谢广坤-路人   </a></p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/4.png" alt=""></p>
<p>可以发现，我们自动把这个字符串长段，转化为了User对象。</p>
<h4 id="GenericConverter集合和数组转换"><a href="#GenericConverter集合和数组转换" class="headerlink" title="GenericConverter集合和数组转换"></a>GenericConverter集合和数组转换</h4><p>GenericConverter是数组转换器。因为SpringMVC自身提供了一些数组转换器，需要自定义的不多，所以这里只介绍SpringMVC自定义的数组转换器。</p>
<p>假设需要同时新增多个用户，这样便需传递一个用户列表（List&lt;User＞）给控制器。此时SpringMVC会使用StringToCollectionConverter转它，这个类实现了GenericConverter接口，并且是SpringVC内部己经注册的数组转换器。</p>
<p>它首会把字符串用逗号分隔为个个的子宇符串，然后根据原类型泛型为String、目标类型泛型为User。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">list</span><span class="params">(List&lt;User&gt; userList)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> userList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实验方法和上面的一样，多个用户只需要使用逗号隔开就行了。</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/SSM/">SSM</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/15/spring12/"><i class="fa fa-chevron-left">  </i><span>SpringMVC详解（三）</span></a></div><div class="next-post pull-right"><a href="/2020/02/11/spring10/"><span>SpringMVC详解（一）</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://bbsfiles.vivo.com.cn/vivobbs/attachment/forum/201706/23/120105q39c9ql9syl7b4ye.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2022 By 攀</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"superSample":2,"width":210,"height":420,"position":"right","hOffset":0,"vOffset":-20},"log":false,"tagMode":false});</script></body></html>