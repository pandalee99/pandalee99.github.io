<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SpringMVC详解（四）"><meta name="keywords" content="SpringBoot,SSM"><meta name="author" content="攀"><meta name="copyright" content="攀"><title>SpringMVC详解（四） | 小世界</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="小世界" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC详解（四）"><span class="toc-number">1.</span> <span class="toc-text">SpringMVC详解（四）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#视图和视图解析器"><span class="toc-number">1.1.</span> <span class="toc-text">视图和视图解析器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#视图设计"><span class="toc-number">1.1.1.</span> <span class="toc-text">视图设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#视图实例——导出PDF文件"><span class="toc-number">1.1.2.</span> <span class="toc-text">视图实例——导出PDF文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AbstractPdtView的源码的抽象方法："><span class="toc-number">1.1.2.1.</span> <span class="toc-text">AbstractPdtView的源码的抽象方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pom-xml"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#定义PDF导出接口"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">定义PDF导出接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PDF导出视图类"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">PDF导出视图类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#由控制器导出PDF数据"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">由控制器导出PDF数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#测试"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#踩坑"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">踩坑</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件上传"><span class="toc-number">1.2.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringMVC对文件上传的支持"><span class="toc-number">1.2.1.</span> <span class="toc-text">SpringMVC对文件上传的支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件上传的配置"><span class="toc-number">1.2.2.</span> <span class="toc-text">文件上传的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开发文件上传功能"><span class="toc-number">1.2.3.</span> <span class="toc-text">开发文件上传功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#upload"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">upload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FileController"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">FileController</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#测试-1"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器"><span class="toc-number">1.3.</span> <span class="toc-text">拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#拦截器的设计"><span class="toc-number">1.3.1.</span> <span class="toc-text">拦截器的设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开发拦截器"><span class="toc-number">1.3.2.</span> <span class="toc-text">开发拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#拦截器实例"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">拦截器实例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#配置拦截器"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">配置拦截器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#控制器和页面"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">控制器和页面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#测试："><span class="toc-number">1.3.2.4.</span> <span class="toc-text">测试：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多个拦截器的顺序"><span class="toc-number">1.3.3.</span> <span class="toc-text">多个拦截器的顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#多个拦截器实例"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">多个拦截器实例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#注册拦截器"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">注册拦截器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#测试-2"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://s1.ax1x.com/2022/04/26/L7HSoV.jpg"></div><div class="author-info__name text-center">攀</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/Pandalee99">GitHub</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">84</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">58</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">链接</div><a class="author-info-links__name text-center" href="https://github.com/Pandalee99/Concurrent-programming">GItHub配套资源</a><a class="author-info-links__name text-center" href="https://translate.google.cn/" target="_blank" rel="noopener">Google翻译</a><a class="author-info-links__name text-center" href="https://www.bilibili.com/" target="_blank" rel="noopener">bilibili</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://bbsfiles.vivo.com.cn/vivobbs/attachment/forum/201706/23/120105q39c9ql9syl7b4ye.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">小世界</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">SpringMVC详解（四）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-18</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="SpringMVC详解（四）"><a href="#SpringMVC详解（四）" class="headerlink" title="SpringMVC详解（四）"></a>SpringMVC详解（四）</h2><h3 id="视图和视图解析器"><a href="#视图和视图解析器" class="headerlink" title="视图和视图解析器"></a>视图和视图解析器</h3><p>视图是渲染数据模型展示给用户的组件，在SpringMVC中又分为逻辑视图和非逻辑视图。逻辑图是需要视图解析器（ViewResolver）进行进一步定位的。</p>
<p>现在我们来看看视图是如何设计和使用的。</p>
<h4 id="视图设计"><a href="#视图设计" class="headerlink" title="视图设计"></a>视图设计</h4><p>视图的类型有很多，比如前面的HTML页面就是最为经典的视图，但是也有很多其他的视图，比如JSON视图，JSP视图，当然不止仅有网络视图，连Excel、PDF也算作为一种视图。</p>
<p>视图都会现实SpringMVC中的View接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">View</span></span>&#123;</span><br><span class="line">    <span class="comment">//响应状态属性</span></span><br><span class="line">    String RESPONSE_STATUS_ATTRIBUTE =View<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>()+”.<span class="title">responseStatus</span>”</span>; </span><br><span class="line">    <span class="comment">//路径变盘</span></span><br><span class="line">    String PATH_VARIABLES=View<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>()+”.<span class="title">pathVariables</span>”</span>;</span><br><span class="line">    <span class="comment">//选择内容类型</span></span><br><span class="line">    String SELECTED_CONTENT_TYPE=View<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>()+”.<span class="title">selectedContentType</span>”</span>;</span><br><span class="line">    <span class="comment">//响应类型</span></span><br><span class="line">    <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//渲染方法</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">(Map&lt;String,?&gt;model,HttpServletRequest request,HttpServletResponse response)</span><span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>这段代码中有两个方法，其中getContentType方法是获取HTTP响应类型的，它可以返回的类型是文本、JSON数据集或者文件等，而rend巳r方法则是将数据模型渲染到视图的，这是视图的核心方法，所以有必要进一步地讨论它。</p>
<p>在它的参数中，model是数据模型，实际就是从控制器（或者由处理器自动绑定）返回的数据模型，这样render方法就可以把它渲染出来。</p>
<p>渲染视图是比较复杂的过程，为了简化视图渲染的开发，在SpringMVC中已经给开发者提供了许多开发好的视图类，所以在大部分的情况下并不需要自己开发自己的视图。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/images/4.png" alt=""></p>
<p>如图所示，SpringMVC中己经开发好了各种各样的视图，所以在大部分情况下，只需要定义如何将数据模型渲染到视图中展示给用户即可。</p>
<p>例如，之前看到的MappingJackson2JsonView视图，因为它不是逻辑视图，所以并不需要使用视图解析器（ViewResolver）去定位视图，它会将数据模型渲染为JSON数据集展示给用户查看；而常用的视图JstlView，则是一个逻辑视图，于是可以在控制器返回一个字符串，使用视图解析器去定位对应的JSP文件，就能够找到对应的JSP文件，将数据模型传递进入，Jst!View就会将数据模型渲染，展示数据给用户。对于PDF和Excel视图等类型的视图，它们只需要接收数据模型，然后通过自定义的渲染即可。为了说明视图的使用方法，下面将介绍如何使用PDF视图——AbstractPdtView。</p>
<h4 id="视图实例——导出PDF文件"><a href="#视图实例——导出PDF文件" class="headerlink" title="视图实例——导出PDF文件"></a>视图实例——导出PDF文件</h4><p>可以从字面意思上看出，AbstractPdtView是一个抽象类，而且，AbstractPdtView属于非逻辑视图，因此它不需要任何的视图解析器去定位。我们先来看看这个</p>
<h5 id="AbstractPdtView的源码的抽象方法："><a href="#AbstractPdtView的源码的抽象方法：" class="headerlink" title="AbstractPdtView的源码的抽象方法："></a>AbstractPdtView的源码的抽象方法：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*通过数据模型自定义创建PDF文档女</span></span><br><span class="line"><span class="comment">＠param model数据模型</span></span><br><span class="line"><span class="comment">@param document iText Document代表一个PDF文档</span></span><br><span class="line"><span class="comment">@param writer PdfWriter PDF写入器</span></span><br><span class="line"><span class="comment">＠param request HttpServletRequest请求对象</span></span><br><span class="line"><span class="comment">@param response HttpServletResponse响应对象</span></span><br><span class="line"><span class="comment">@throws Exception异常*/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildPdfDocument</span><span class="params">(Map&lt;String,Object&gt; model,Document document,PdfWriter writer,HttpServletRequest request,HttpServletResponse response)</span><span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>通过PDF视图的定义，就只需要实现这个抽象方法便可以将数据模型渲染为PDF。而这个方法中的参数，包含数据模型（model）对象、HTTP的请求（request）和响应（response）对象，通过这就可以得到数据模型和上下文环境的参数，此外方法中还有与PDF文档有关的参数（document和writer），通过它们就可以制PDF的格和数据的渲染。</p>
<h5 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h5><p>当然也需要加入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        PDF--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xhtmlrenderer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>core-renderer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>R8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itextpdf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>itextpdf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后便可以开始程序设计了</p>
<h5 id="定义PDF导出接口"><a href="#定义PDF导出接口" class="headerlink" title="定义PDF导出接口"></a>定义PDF导出接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PdfExportService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">(Map&lt;String, Object&gt; model, Document document,</span></span></span><br><span class="line"><span class="function"><span class="params">                     PdfWriter writer, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                     HttpServletResponse response)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要继承这个接口，就能够自定义导出逻辑了。</p>
<p>接着是写一个类，让其继承AbstractPdfView的非抽象类。</p>
<h5 id="PDF导出视图类"><a href="#PDF导出视图类" class="headerlink" title="PDF导出视图类"></a>PDF导出视图类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PdfView</span> <span class="keyword">extends</span> <span class="title">AbstractPdfView</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 导出服务接口</span></span><br><span class="line">    <span class="keyword">private</span> PdfExportService pdfExportService = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建对象的时候载入导出服务接口</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PdfView</span><span class="params">(PdfExportService pdfExportService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pdfExportService = pdfExportService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用接口实现</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">buildPdfDocument</span><span class="params">(Map&lt;String, Object&gt; model, Document document,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    PdfWriter writer, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 调用导出服务接口类</span></span><br><span class="line">        pdfExportService.make(model, document, writer, request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，创建PDF对象的时候，便调用这个构造函数，而这个构造函数将调用AbstractPdfView接口的抽象方法，完成内部实现。</p>
<h5 id="由控制器导出PDF数据"><a href="#由控制器导出PDF数据" class="headerlink" title="由控制器导出PDF数据"></a>由控制器导出PDF数据</h5><p>接下来就是由控制器去导出PDF文件了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出接口</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/export/pdf"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">exportPdf</span><span class="params">(String userName, String note)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 查询用户信息列表</span></span><br><span class="line">	List&lt;User&gt; userList = userService.findUsers(userName, note);</span><br><span class="line">	<span class="comment">// 定义PDF视图</span></span><br><span class="line">	View view = <span class="keyword">new</span> PdfView(exportService());</span><br><span class="line">	ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">	<span class="comment">// 设置视图</span></span><br><span class="line">	mv.setView(view);</span><br><span class="line">	<span class="comment">// 加入数据模型</span></span><br><span class="line">	mv.addObject(<span class="string">"userList"</span>, userList);</span><br><span class="line">	<span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出PDF自定义</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> PdfExportService <span class="title">exportService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 使用Lambda表达式定义自定义导出</span></span><br><span class="line">	<span class="keyword">return</span> (model, document, writer, request, response) -&gt; &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// A4纸张</span></span><br><span class="line">			document.setPageSize(PageSize.A4);</span><br><span class="line">			<span class="comment">// 标题</span></span><br><span class="line">			document.addTitle(<span class="string">"用户信息"</span>);</span><br><span class="line">			<span class="comment">// 换行</span></span><br><span class="line">			document.add(<span class="keyword">new</span> Chunk(<span class="string">"\n"</span>));</span><br><span class="line">			<span class="comment">// 表格，3列</span></span><br><span class="line">			PdfPTable table = <span class="keyword">new</span> PdfPTable(<span class="number">3</span>);</span><br><span class="line">			<span class="comment">// 单元格</span></span><br><span class="line">			PdfPCell cell = <span class="keyword">null</span>;</span><br><span class="line">			<span class="comment">// 字体，定义为蓝色加粗</span></span><br><span class="line">			Font f8 = <span class="keyword">new</span> Font();</span><br><span class="line">			f8.setColor(Color.BLUE);</span><br><span class="line">			f8.setStyle(Font.BOLD);</span><br><span class="line">			<span class="comment">// 标题</span></span><br><span class="line">			cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(<span class="string">"id"</span>, f8));</span><br><span class="line">			<span class="comment">// 居中对齐</span></span><br><span class="line">			cell.setHorizontalAlignment(<span class="number">1</span>);</span><br><span class="line">			<span class="comment">// 将单元格加入表格</span></span><br><span class="line">			table.addCell(cell);</span><br><span class="line">			cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(<span class="string">"user_name"</span>, f8));</span><br><span class="line">			<span class="comment">// 居中对齐</span></span><br><span class="line">			cell.setHorizontalAlignment(<span class="number">1</span>);</span><br><span class="line">			table.addCell(cell);</span><br><span class="line">			cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(<span class="string">"note"</span>, f8));</span><br><span class="line">			cell.setHorizontalAlignment(<span class="number">1</span>);</span><br><span class="line">			table.addCell(cell);</span><br><span class="line">			<span class="comment">// 获取数据模型中的用户列表</span></span><br><span class="line">			List&lt;User&gt; userList = (List&lt;User&gt;) model.get(<span class="string">"userList"</span>);</span><br><span class="line">			<span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">				document.add(<span class="keyword">new</span> Chunk(<span class="string">"\n"</span>));</span><br><span class="line">				cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(user.getId() + <span class="string">""</span>));</span><br><span class="line">				table.addCell(cell);</span><br><span class="line">				cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(user.getUserName()));</span><br><span class="line">				table.addCell(cell);</span><br><span class="line">				String note = user.getNote() == <span class="keyword">null</span> ? <span class="string">""</span> : user.getNote();</span><br><span class="line">				cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(note));</span><br><span class="line">				table.addCell(cell);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 在文档中加入表格</span></span><br><span class="line">			document.add(table);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (DocumentException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法先通过查询后台数据得到用户列表，再放入模型和视图（ModelAndView）中，然后设置一个视图（PdfView）。而定义dfView时，使用Lambda表达式实现了导出服务接口，这样就可以很方便地让每一个控制器自定义样式和数据。</p>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><p>打开浏览器，输入：<a href="http://localhost:8888/user/export/pdf?userName=张三&amp;note=人" target="_blank" rel="noopener">http://localhost:8888/user/export/pdf?userName=张三&amp;note=人</a></p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/8.png" alt=""></p>
<h5 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h5><p>这其中有个最为常见的坑，那就是PDF不显示中文的现象，上述代码通过加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BaseFont Chinese = BaseFont.createFont(<span class="string">"C:\\Windows\\Fonts\\simsun.ttc,1"</span>,BaseFont.IDENTITY_H,BaseFont.NOT_EMBEDDED);</span><br><span class="line"><span class="comment">//使得：</span></span><br><span class="line">Font f8 = <span class="keyword">new</span> Font(Chinese);</span><br><span class="line"><span class="comment">//最后在cell和Paragraph构造中加入f8就行了</span></span><br></pre></td></tr></table></figure>

<p>截取部分：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">				Font f8 = <span class="keyword">new</span> Font(Chinese);</span><br><span class="line"><span class="comment">//.............</span></span><br><span class="line">				cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(<span class="string">"id"</span>, f8));</span><br><span class="line"><span class="comment">//.................</span></span><br><span class="line">				List&lt;User&gt; userList = (List&lt;User&gt;) model.get(<span class="string">"userList"</span>);</span><br><span class="line">				<span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">					document.add(<span class="keyword">new</span> Chunk(<span class="string">"\n"</span>));</span><br><span class="line">					cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Paragraph(user.getId() + <span class="string">""</span>,f8));</span><br><span class="line"><span class="comment">//...................</span></span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>



<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>文件上传在web中可以说是必须有的操作了，SpringMVC也对其有着很好的支持。</p>
<h4 id="SpringMVC对文件上传的支持"><a href="#SpringMVC对文件上传的支持" class="headerlink" title="SpringMVC对文件上传的支持"></a>SpringMVC对文件上传的支持</h4><p>首先，DispatcherServlet会使用适配器模式，将HttpServletRequest接口对象转换为MultipartHttpServletRequest象。MultipartHttpServletRequest接口扩展了HttpServletRequest接口的所有方法，而且定义了一些操作文件的方法，这样通过这些方法就可以实现对上传文件的操作。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/images/5.png" alt=""></p>
<p>这里对于文件上传的场景，SpringMVC会将HttpServletRequest对象转化为MultipartHttpServlet­Request对象。</p>
<p>从MultipartHttpServletRequest接口的定义看，它存在许多的方法用来处理文件，这样SpringMVC中操作文件就十分便捷。只是在使用SpringMVC上传文件时，还需要配置MultipartHttpServletRequest，这个任务是通过MultipartResolver接口实现的。</p>
<p>对于MultipartResover接口，它又存在两个实现类，这两个实现类分是StandardServletMultipartResolver和CommonsMultipartResolver，可以使用它们中的任意一个来现文件上传。在默认的情况下Spring推荐使用的是StandardServletMultipartResolver，因为它只需要依赖于ServletAPI提供的包，而对于CommonsMultipartResolver，则需要依赖于Apache提供的第三方包来实，这然没有StandardServletMultipartResolver来实在。</p>
<p>从实用的角度来说，因为Spring3.1之后己经能够支持StandardServletMultipartR巳solver，所以CommonsMultipartResolver已经渐渐被废弃了，因此这里不再对其进行介绍。</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/images/6.png" alt=""></p>
<h4 id="文件上传的配置"><a href="#文件上传的配置" class="headerlink" title="文件上传的配置"></a>文件上传的配置</h4><p>打开application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servlet:</span></span><br><span class="line">  <span class="attr">multipart:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#是否开启SpringMVC多分布上传功能</span></span><br><span class="line">    <span class="attr">file-size-threshold:</span> <span class="number">0</span> <span class="comment">#将文件写入磁盘阈值，值可以使用后缀“MB”或者是“KB”来表示兆字节大小</span></span><br><span class="line">    <span class="attr">location:</span> <span class="comment">#指定默认上传文件夹，一般不设置</span></span><br><span class="line">    <span class="attr">max-file-size:</span> <span class="string">5MB</span> <span class="comment">#设置单个文件最大值</span></span><br><span class="line">    <span class="attr">max-request-size:</span> <span class="string">100MB</span> <span class="comment">#设置所有文件最大值</span></span><br><span class="line">    <span class="attr">resolve-lazily:</span> <span class="literal">false</span> <span class="comment">#是否延迟多部件文件请求的参数和文件解析</span></span><br></pre></td></tr></table></figure>

<p>根据这些配置，SpringBoot会自动生成StandardServletMultipartResolv巳r对象这样就能够对上传的文件进行配置。对于文件的上传可以使用ServletAPI提供的Part接口或者SpringMVC提供的MultipartFile接作为参数。</p>
<h4 id="开发文件上传功能"><a href="#开发文件上传功能" class="headerlink" title="开发文件上传功能"></a>开发文件上传功能</h4><h5 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;</span><br><span class="line">      action&#x3D;&quot;.&#x2F;part&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; value&#x3D;&quot;请选择上传的文件&quot; &#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<p>注意，这里的的form表单的类型必须声明为： enctype=”multipart/form-data”。如果没有这个声明，SpringMVC就不能自动对其解析。</p>
<h5 id="FileController"><a href="#FileController" class="headerlink" title="FileController"></a>FileController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/file"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打开文件上传请求页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 指向HTML的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/page"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"upload"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用HttpServletRequest作为参数</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/request"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">uploadRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        MultipartHttpServletRequest mreq = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 强制转换为MultipartHttpServletRequest接口对象</span></span><br><span class="line">        <span class="keyword">if</span> (request <span class="keyword">instanceof</span> MultipartHttpServletRequest) &#123;</span><br><span class="line">            mreq = (MultipartHttpServletRequest) request;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> dealResultMap(<span class="keyword">false</span>, <span class="string">"上传失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取MultipartFile文件信息</span></span><br><span class="line">        MultipartFile mf = mreq.getFile(<span class="string">"file"</span>);</span><br><span class="line">        <span class="comment">// 获取源文件名称</span></span><br><span class="line">        String fileName = mf.getOriginalFilename();</span><br><span class="line">        File file = <span class="keyword">new</span> File(fileName);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 保存文件</span></span><br><span class="line">            mf.transferTo(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> dealResultMap(<span class="keyword">false</span>, <span class="string">"上传失败"</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="keyword">true</span>, <span class="string">"上传成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用Spring MVC的MultipartFile类作为参数</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/multipart"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">uploadMultipartFile</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        String fileName = file.getOriginalFilename();</span><br><span class="line">        File dest = <span class="keyword">new</span> File(fileName);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(dest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> dealResultMap(<span class="keyword">false</span>, <span class="string">"上传失败"</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="keyword">true</span>, <span class="string">"上传成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/part"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">uploadPart</span><span class="params">(Part file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取提交文件名称</span></span><br><span class="line">        String fileName = file.getSubmittedFileName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 写入文件</span></span><br><span class="line">            file.write(fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> dealResultMap(<span class="keyword">false</span>, <span class="string">"上传失败"</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="keyword">true</span>, <span class="string">"上传成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理上传文件结果</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">dealResultMap</span><span class="params">(<span class="keyword">boolean</span> success, String msg)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        result.put(<span class="string">"success"</span>, success);</span><br><span class="line">        result.put(<span class="string">"msg"</span>, msg);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中uploadPage方法用来映射上传文件的HTML页面，所以只需要请求它便能够打开上传文件的页面。</p>
<p>uploadRequest方法则将HttpServletRequest对象传递，从之前的分析可知，在调用控制器之前，DispatcherServlet会将其转换为MultipartHttpServletRequest对象，所以方法中使用了强制转换，从而得到MultipartHttpServletRequest对象，然后获取MultipartFile对象，接着使用MultipartFile对象的getOrigina!Filename方法就可以得到上传的文件名，而通过它的transferTo方法，就可以将文件保存到对应的路径中。</p>
<p>uploadMultipartFile则是直接使用MultipartFile对象获取上传的文件，从而进行操作。uploadPart方法是使用Servlet的API，可以使用其write方法直接写入文件，这种方式更为巧妙。</p>
<h5 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h5><p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/9.png" alt=""></p>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p>虽然我们已经拥有Security来做我们的拦截器了，但是还是很有必要了解一下SpringMVC自带的拦截器。</p>
<p>在刚提起SpringMVC的时候，就说过DispatcherServlet，请求来到DispatcherServlet，它会根据HandlerMapping的机制找到处理器，这样就会返回一个HandlerExecutionChain对象，这个对象包含处理器和拦截器。这里的拦截器会对处理器进行拦截，这样通过截器就可以增强处理器的功能。</p>
<h4 id="拦截器的设计"><a href="#拦截器的设计" class="headerlink" title="拦截器的设计"></a>拦截器的设计</h4><p>所有的拦截器都继承了一个接口：HandlerInterceptor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//处理执行前</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//处理器处理方法后</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//处理器完成方法后</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行流程比较直观，如图：</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/images/7.png" alt=""></p>
<ol>
<li>执行preHandle方法，该方法会返回一个布尔值。如果为false，则结束所有流程：如果为true,则执行下一步。</li>
<li>执行处理器逻辑，它包含控制器的功能。</li>
<li>执行postHandle方法。</li>
<li>执行视图解析和视图渲染。</li>
<li>执行afterCompletion方法。</li>
</ol>
<p>因为这个接口是Java8的接口，所以3个方法都被声明为default，并且提供了空实现。当我们需要自己定义方法的时候，只需要实现HandlerInterceptor，覆盖其对应的方法即可。</p>
<h4 id="开发拦截器"><a href="#开发拦截器" class="headerlink" title="开发拦截器"></a>开发拦截器</h4><h5 id="拦截器实例"><a href="#拦截器实例" class="headerlink" title="拦截器实例"></a>拦截器实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Interceptor1</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"处理器前方法"</span>);</span><br><span class="line">        <span class="comment">// 返回true，不会拦截后续的处理</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">            ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"处理器后方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletResponse response, Object handler, Exception ex)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"处理器完成方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的代码实现了Handlerlnterceptor，然后按照自己的需要重写了3具体的拦截器方法。在这些方法中都打印了一些信息，这样就可以定位拦截器方法的执行顺序。</p>
<p>其中这里的preHandle法返回的是true，也可以将其修改为返回false，再观察其不同。有了这个拦截器，SpringMVC并不会发现它，它还需要进行注册才能够拦截处理器，为此需要在配文件中实现WebMvcConfigurer接口：</p>
<h5 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMVCConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 注册拦截器到Spring MVC机制，然后它会返回一个拦截器注册</span></span><br><span class="line">      InterceptorRegistration ir = registry.addInterceptor(<span class="keyword">new</span> Interceptor1());</span><br><span class="line">      <span class="comment">// 指定拦截匹配模式，限制拦截器拦截请求</span></span><br><span class="line">      ir.addPathPatterns(<span class="string">"/interceptor/*"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里通过实现WebMvcConfigurer接口，重写其中的addlnterceptors方法，进而加入自定义拦截器一一Interceptor!，然后指定其拦截的模式，所以它只会拦截与正则式“／interceptor/*”匹配的请求。</p>
<h5 id="控制器和页面"><a href="#控制器和页面" class="headerlink" title="控制器和页面"></a>控制器和页面</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/interceptor"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/start"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行处理器逻辑"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"/welcome"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好，现在进行测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里非常简单，不多赘述。</p>
<h5 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h5><p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/10.png" alt=""></p>
<p>这里是后台信息，可以从这里看出，拦截器的运行流程。</p>
<h4 id="多个拦截器的顺序"><a href="#多个拦截器的顺序" class="headerlink" title="多个拦截器的顺序"></a>多个拦截器的顺序</h4><p>如果我们还有多个拦截器，那么它运行的顺序又是怎么样的呢？首先需要多个拦截器实例，当然和前面是一样的，这里仅仅列出来：</p>
<h5 id="多个拦截器实例"><a href="#多个拦截器实例" class="headerlink" title="多个拦截器实例"></a>多个拦截器实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MulitiInterceptor1</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【"</span> + <span class="keyword">this</span>.getClass().getSimpleName()</span><br><span class="line">            +<span class="string">"】处理器前方法"</span>);</span><br><span class="line">        <span class="comment">// 返回true，不会拦截后续的处理</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">            ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【"</span> + <span class="keyword">this</span>.getClass().getSimpleName()</span><br><span class="line">            +<span class="string">"】处理器后方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletResponse response, Object handler, Exception ex)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【"</span> + <span class="keyword">this</span>.getClass().getSimpleName()</span><br><span class="line">            +<span class="string">"】处理器完成方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//......省略同样的三个类</span></span><br></pre></td></tr></table></figure>

<p>然后，注册拦截器</p>
<h5 id="注册拦截器"><a href="#注册拦截器" class="headerlink" title="注册拦截器"></a>注册拦截器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册拦截器到Spring MVC机制中</span></span><br><span class="line"> InterceptorRegistration ir = registry.addInterceptor(<span class="keyword">new</span></span><br><span class="line">         MulitiInterceptor1());</span><br><span class="line"> <span class="comment">// 指定拦截匹配模式</span></span><br><span class="line"> ir.addPathPatterns(<span class="string">"/interceptor/*"</span>);</span><br><span class="line"> <span class="comment">// 注册拦截器到Spring MVC机制中</span></span><br><span class="line"> InterceptorRegistration ir2 = registry.addInterceptor(<span class="keyword">new</span></span><br><span class="line">         MulitiInterceptor2());</span><br><span class="line"> <span class="comment">// 指定拦截匹配模式</span></span><br><span class="line"> ir2.addPathPatterns(<span class="string">"/interceptor/*"</span>);</span><br><span class="line"> <span class="comment">// 注册拦截器到Spring MVC机制中</span></span><br><span class="line"> InterceptorRegistration ir3 = registry.addInterceptor(<span class="keyword">new</span></span><br><span class="line">         MulitiInterceptor3());</span><br><span class="line"> <span class="comment">// 指定拦截匹配模式</span></span><br><span class="line"> ir3.addPathPatterns(<span class="string">"/interceptor/*"</span>);</span><br></pre></td></tr></table></figure>

<p>这些代码放在WebMVCConfiguration 下面。</p>
<h5 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h5><p>同样的，我们直接去查看控制台：</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/11.png" alt=""></p>
<p>我们发现，这个结果是责任链模式的规则，对于处理器前方法采用先注册先执行，而处理器后方法完成方法则是先注册后执行的规则。只是上述仅测试了处理器前（preHandle）方法返回为true的场景，在某些时候还可能返回为false，这个时候又如何呢？为此，可以将Mulitilnterceptor2的preHandle法修改返回为false，然后再进行测试，其日志如下：</p>
<p><img src="https://gitee.com/antarctica/img_sotre/raw/img/img/SpringMVC/xiangjie2to4/12.png" alt=""></p>
<p>上面的日志可以看出，处理器前（preHandle）方法会执行，但是一旦返回false，则续的拦截器、处理器和l所有拦截器的处理器后（postHandle）方法都不会被执行。完成方法afterCompletion则不一样，它只会执行返回true的拦截器的完成方法，而且顺序是先注册后执行。</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/SSM/">SSM</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/22/spring14/"><i class="fa fa-chevron-left">  </i><span>实现SpringBoot上传图片到七牛云</span></a></div><div class="next-post pull-right"><a href="/2020/02/15/spring12/"><span>SpringMVC详解（三）</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://bbsfiles.vivo.com.cn/vivobbs/attachment/forum/201706/23/120105q39c9ql9syl7b4ye.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2022 By 攀</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"superSample":2,"width":210,"height":420,"position":"right","hOffset":0,"vOffset":-20},"log":false,"tagMode":false});</script></body></html>