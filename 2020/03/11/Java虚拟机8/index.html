<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Java虚拟机（八）Class文件基本组织结构"><meta name="keywords" content="Java虚拟机"><meta name="author" content="攀"><meta name="copyright" content="攀"><title>Java虚拟机（八）Class文件基本组织结构 | 小世界</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="小世界" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Class文件基本组织结构"><span class="toc-number">1.</span> <span class="toc-text">Class文件基本组织结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#魔数-magic"><span class="toc-number">1.0.1.</span> <span class="toc-text">魔数(magic)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#版本号-minor-version-major-version"><span class="toc-number">1.0.2.</span> <span class="toc-text">版本号(minor_version,major_version)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常量池计数器-constant-pool-count"><span class="toc-number">1.0.3.</span> <span class="toc-text">常量池计数器(constant_pool_count)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常量池数据区-constant-pool-contstant-pool-count-1"><span class="toc-number">1.0.4.</span> <span class="toc-text">常量池数据区(constant_pool[contstant_pool_count-1])</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#访问标志-access-flags"><span class="toc-number">1.0.5.</span> <span class="toc-text">访问标志(access_flags)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#类索引-this-class"><span class="toc-number">1.0.6.</span> <span class="toc-text">类索引(this_class)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#父类索引-super-class"><span class="toc-number">1.0.7.</span> <span class="toc-text">父类索引(super_class)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接口计数器-interfaces-count"><span class="toc-number">1.0.8.</span> <span class="toc-text">接口计数器(interfaces_count)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接口信息数据区-interfaces-interfaces-count"><span class="toc-number">1.0.9.</span> <span class="toc-text">接口信息数据区(interfaces[interfaces_count])</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字段计数器-fields-count"><span class="toc-number">1.0.10.</span> <span class="toc-text">字段计数器(fields_count)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字段信息数据区-fields-fields-count"><span class="toc-number">1.0.11.</span> <span class="toc-text">字段信息数据区(fields[fields_count])</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方法计数器-methods-count"><span class="toc-number">1.0.12.</span> <span class="toc-text">方法计数器(methods_count)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方法信息数据区-methods-methods-count"><span class="toc-number">1.0.13.</span> <span class="toc-text">方法信息数据区(methods[methods_count])</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#属性计数器-attributes-count"><span class="toc-number">1.0.14.</span> <span class="toc-text">属性计数器(attributes_count)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#属性信息数据区-attributes-attributes-count"><span class="toc-number">1.0.15.</span> <span class="toc-text">属性信息数据区(attributes[attributes_count])</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/pandalee99/image_store/master/hexo/c17f0489-42cd-439a-94bd-0612598b142f.jpg"></div><div class="author-info__name text-center">攀</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/Pandalee99">GitHub</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">104</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">70</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">链接</div><a class="author-info-links__name text-center" href="https://github.com/Pandalee99/Concurrent-programming">GItHub配套资源</a><a class="author-info-links__name text-center" href="https://translate.google.cn/" target="_blank" rel="noopener">Google翻译</a><a class="author-info-links__name text-center" href="https://www.bilibili.com/" target="_blank" rel="noopener">bilibili</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://bbsfiles.vivo.com.cn/vivobbs/attachment/forum/201706/23/120105q39c9ql9syl7b4ye.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">小世界</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Java虚拟机（八）Class文件基本组织结构</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-11</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Class文件基本组织结构"><a href="#Class文件基本组织结构" class="headerlink" title="Class文件基本组织结构"></a>Class文件基本组织结构</h2><p>关于类和对象，已经是老生常谈的事情了。关于对象的结构，在讲述Synchronized的时候，大致的讲述了一遍，而现在开始学习，关于Class文件的结构。</p>
<p>我们先放一个示意图：</p>
<p><img src="/images/img/jvm/2020%E5%B9%B43%E6%9C%8811%E6%97%A5142543.png" alt=""></p>
<p>这就是Class文件的组织结构，下面我们一步一步讲解，它们是什么。</p>
<h4 id="魔数-magic"><a href="#魔数-magic" class="headerlink" title="魔数(magic)"></a>魔数(magic)</h4><p>当JVM在尝试加载某个文件到内存中来的时候，会首先判断此class文件有没有JVM认为可以接受的“签名”，即JVM会首先读取文件的前4个字节，判断该4个字节是否是“0xCAFEBABE”，如果是，则JVM会认为可以将此文件当作class文件来加载并使用。</p>
<p>可以看作为，这是一个最基本的保险，它会对文件进行基本的验证，以致于不会随便改一个后缀名，就能入JVM的法眼。</p>
<h4 id="版本号-minor-version-major-version"><a href="#版本号-minor-version-major-version" class="headerlink" title="版本号(minor_version,major_version)"></a>版本号(minor_version,major_version)</h4><p>Java有很多不同的版本，不同的JDK里面，Class的结构多少都会有着轻微的调动，面对这样情况，Java虚拟机会让每一个类文件中包含自己的JDK版本。</p>
<p>主版本号和次版本号在class文件中各占两个字节，副版本号占用第5、6两个字节，而主版本号则占用第7，8两个字节。JDK1.0的主版本号为45，以后的每个新主版本都会在原先版本的基础上加1。若现在使用的是JDK1.7编译出来的class文件，则相应的主版本号应该是51,对应的7，8个字节的十六进制的值应该是 0x33。</p>
<p> 一个 JVM实例只能支持特定范围内的主版本号 （Mi 至Mj） 和 0 至特定范围内 （0 至 m） 的副版本号。假设一个 Class 文件的格式版本号为 V， 仅当Mi.0 ≤ v ≤ Mj.m成立时，这个 Class 文件才可以被此 Java 虚拟机支持。不同版本的 Java 虚拟机实现支持的版本号也不同，高版本号的 Java 虚拟机实现可以支持低版本号的 Class 文件，反之则不成立。</p>
<p>JVM在加载class文件的时候，会读取出主版本号，然后比较这个class文件的主版本号和JVM本身的版本号，如果JVM本身的版本号 &lt; class文件的版本号，JVM会认为加载不了这个class文件，会抛出我们经常见到的<strong>“java.lang.UnsupportedClassVersionError: Bad version number in .class file “</strong> Error 错误；反之，JVM会认为可以加载此class文件，继续加载此class文件。</p>
<h4 id="常量池计数器-constant-pool-count"><a href="#常量池计数器-constant-pool-count" class="headerlink" title="常量池计数器(constant_pool_count)"></a>常量池计数器(constant_pool_count)</h4><p>常量池是class文件中非常重要的结构，它描述着整个class文件的字面量信息。 常量池是由一组constant_pool结构体数组组成的，而数组的大小则由常量池计数器指定。常量池计数器constant_pool_count 的值 =constant_pool表中的成员数+ 1。constant_pool表的索引值只有在大于 0 且小于constant_pool_count时才会被认为是有效的。</p>
<h4 id="常量池数据区-constant-pool-contstant-pool-count-1"><a href="#常量池数据区-constant-pool-contstant-pool-count-1" class="headerlink" title="常量池数据区(constant_pool[contstant_pool_count-1])"></a>常量池数据区(constant_pool[contstant_pool_count-1])</h4><p>常量池，constant_pool是一种表结构,它包含 Class 文件结构及其子结构中引用的所有字符串常量、 类或接口名、字段名和其它常量。 常量池中的每一项都具备相同的格式特征——第一个字节作为类型标记用于识别该项是哪种类型的常量，称为 “tag byte” 。常量池的索引范围是 1 至constant_pool_count−1。</p>
<h4 id="访问标志-access-flags"><a href="#访问标志-access-flags" class="headerlink" title="访问标志(access_flags)"></a>访问标志(access_flags)</h4><p>访问标志，access_flags 是一种掩码标志，用于表示某个类或者接口的访问权限及基础属性。如图：</p>
<p><img src="/images/img/jvm/2020%E5%B9%B43%E6%9C%8811%E6%97%A5142550.png" alt=""></p>
<h4 id="类索引-this-class"><a href="#类索引-this-class" class="headerlink" title="类索引(this_class)"></a>类索引(this_class)</h4><p>类索引，this_class的值必须是对constant_pool表中项目的一个有效索引值。constant_pool表在这个索引处的项必须为CONSTANT_Class_info 类型常量，表示这个 Class 文件所定义的类或接口。通俗点讲，它表示的就是类本身的名字。</p>
<h4 id="父类索引-super-class"><a href="#父类索引-super-class" class="headerlink" title="父类索引(super_class)"></a>父类索引(super_class)</h4><p>对于类来说，super_class 的值必须为 0 或者是对constant_pool 表中项目的一个有效索引值。如果它的值不为 0，那 constant_pool 表在这个索引处的项必须为CONSTANT_Class_info 类型常量，表示这个 Class 文件所定义的类的直接父类。当前类的直接父类，以及它所有间接父类的access_flag 中都不能带有ACC_FINAL 标记。如果 Class 文件的 super_class的值为 0，那这个Class文件只可能是定义的是java.lang.Object类，只有它是唯一没有父类的类。因此除了java.lang.Object外，所有Java类的父类索引都不为0。</p>
<p>对于接口来说，它的Class文件的super_class项的值必须是对constant_pool表中项目的一个有效索引值。constant_pool表在这个索引处的项必须为代表 java.lang.Object 的 CONSTANT_Class_info 类型常量 。</p>
<h4 id="接口计数器-interfaces-count"><a href="#接口计数器-interfaces-count" class="headerlink" title="接口计数器(interfaces_count)"></a>接口计数器(interfaces_count)</h4><p>接口计数器，interfaces_count的值表示当前类或接口的直接父接口数量。</p>
<h4 id="接口信息数据区-interfaces-interfaces-count"><a href="#接口信息数据区-interfaces-interfaces-count" class="headerlink" title="接口信息数据区(interfaces[interfaces_count])"></a>接口信息数据区(interfaces[interfaces_count])</h4><p>接口表，interfaces[]数组中的每个成员的值必须是一个对constant_pool表中项目的一个有效索引值， 它的长度为 interfaces_count。每个成员 interfaces[i]  必须为 CONSTANT_Class_info类型常量，其中 0 ≤ i &lt;interfaces_count。在interfaces[]数组中，成员所表示的接口顺序和对应的源代码中给定的接口顺序（从左至右）一样，即interfaces[0]对应的是源代码中最左边的接口。</p>
<h4 id="字段计数器-fields-count"><a href="#字段计数器-fields-count" class="headerlink" title="字段计数器(fields_count)"></a>字段计数器(fields_count)</h4><p> 字段计数器，fields_count的值表示当前 Class 文件 fields[]数组的成员个数。 fields[]数组中每一项都是一个field_info结构的数据项，它用于表示该类或接口声明的类字段或者实例字段。这是Java的特性，可以以任意一个类作为数组，这是C++所不具有的。</p>
<h4 id="字段信息数据区-fields-fields-count"><a href="#字段信息数据区-fields-fields-count" class="headerlink" title="字段信息数据区(fields[fields_count])"></a>字段信息数据区(fields[fields_count])</h4><p> 字段表，fields[]数组中的每个成员都必须是一个fields_info结构的数据项，用于表示当前类或接口中某个字段的完整描述。 fields[]数组描述当前类或接口声明的所有字段，但不包括从父类或父接口继承的部分。</p>
<h4 id="方法计数器-methods-count"><a href="#方法计数器-methods-count" class="headerlink" title="方法计数器(methods_count)"></a>方法计数器(methods_count)</h4><p>  方法计数器， methods_count的值表示当前Class 文件 methods[]数组的成员个数。Methods[]数组中每一项都是一个 method_info 结构的数据项。</p>
<h4 id="方法信息数据区-methods-methods-count"><a href="#方法信息数据区-methods-methods-count" class="headerlink" title="方法信息数据区(methods[methods_count])"></a>方法信息数据区(methods[methods_count])</h4><p> 方法表，methods[] 数组中的每个成员都必须是一个 method_info 结构的数据项，用于表示当前类或接口中某个方法的完整描述。如果某个method_info 结构的access_flags 项既没有设置 ACC_NATIVE 标志也没有设置ACC_ABSTRACT 标志，那么它所对应的方法体就应当可以被 Java 虚拟机直接从当前类加载，而不需要引用其它类。 method_info结构可以表示类和接口中定义的所有方法，包括实例方法、类方法、实例初始化方法方法和类或接口初始化方法方法 。methods[]数组只描述当前类或接口中声明的方法，不包括从父类或父接口继承的方法。</p>
<h4 id="属性计数器-attributes-count"><a href="#属性计数器-attributes-count" class="headerlink" title="属性计数器(attributes_count)"></a>属性计数器(attributes_count)</h4><p> 属性计数器，attributes_count的值表示当前 Class 文件attributes表的成员个数。attributes表中每一项都是一个attribute_info 结构的数据项。</p>
<h4 id="属性信息数据区-attributes-attributes-count"><a href="#属性信息数据区-attributes-attributes-count" class="headerlink" title="属性信息数据区(attributes[attributes_count])"></a>属性信息数据区(attributes[attributes_count])</h4><p>属性表，attributes 表的每个项的值必须是attribute_info结构。</p>
<p> 在Java 7 规范里，Class文件结构中的attributes表的项包括下列定义的属性： InnerClasses  、 EnclosingMethod 、 Synthetic  、Signature、SourceFile，SourceDebugExtension 、Deprecated、RuntimeVisibleAnnotations 、RuntimeInvisibleAnnotations以及BootstrapMethods属性。</p>
<p>  对于支持 Class 文件格式版本号为 49.0 或更高的 Java 虚拟机实现，必须正确识别并读取attributes表中的Signature、RuntimeVisibleAnnotations和RuntimeInvisibleAnnotations属性。对于支持Class文件格式版本号为 51.0 或更高的 Java 虚拟机实现，必须正确识别并读取 attributes表中的BootstrapMethods属性。Java 7 规范 要求任一 Java 虚拟机实现可以自动忽略 Class 文件的 attributes表中的若干 （甚至全部） 它不可识别的属性项。任何本规范未定义的属性不能影响Class文件的语义，只能提供附加的描述信息 。</p>
<p>以上就是类文件结构了，可以概括为以下的一张图：</p>
<p><img src="/images/img/jvm/2020%E5%B9%B43%E6%9C%8811%E6%97%A5142555.png" alt=""></p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/">Java虚拟机</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/03/16/Java%E8%99%9A%E6%8B%9F%E6%9C%BA9/"><i class="fa fa-chevron-left">  </i><span>Java虚拟机（九）类加载机制全解析</span></a></div><div class="next-post pull-right"><a href="/2020/03/09/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C1/"><span>项目设计：一个服装定制商城</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://bbsfiles.vivo.com.cn/vivobbs/attachment/forum/201706/23/120105q39c9ql9syl7b4ye.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2025 By 攀</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"superSample":2,"width":210,"height":420,"position":"right","hOffset":0,"vOffset":-20},"log":false,"tagMode":false});</script></body></html>